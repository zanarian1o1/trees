<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinite Tree Growth</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="800" height="600"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const baseLineLength = 50; // Shorter base length for branches
        const maxAngle = Math.PI / 2; // Maximum angle offset for branching (wider range)
        const growSpeed = 200; // Time (ms) between growing steps
        const maxDepth = 10; // How deep the branches will grow

        let branches = []; // Array to hold growing branches
        let drawnLines = []; // Array to store all drawn line segments

        function drawLine(x1, y1, x2, y2) {
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
        }

        function lineIntersects(x1, y1, x2, y2) {
            // Check if the new line intersects any previously drawn line
            for (const line of drawnLines) {
                const { x1: lx1, y1: ly1, x2: lx2, y2: ly2 } = line;

                // Check for intersection
                if (doLinesIntersect(x1, y1, x2, y2, lx1, ly1, lx2, ly2)) {
                    return true;
                }
            }
            return false;
        }

        function doLinesIntersect(x1, y1, x2, y2, x3, y3, x4, y4) {
            // Helper function to determine if two line segments intersect
            function ccw(ax, ay, bx, by, cx, cy) {
                return (cy - ay) * (bx - ax) > (by - ay) * (cx - ax);
            }
            return (
                ccw(x1, y1, x3, y3, x4, y4) !== ccw(x2, y2, x3, y3, x4, y4) &&
                ccw(x1, y1, x2, y2, x3, y3) !== ccw(x1, y1, x2, y2, x4, y4)
            );
        }

        function branch(x, y, angle, depth) {
            if (depth >= maxDepth) return [];

            // Randomize line length and angle offsets
            const length = baseLineLength * (Math.random() * 0.5 + 0.5); // Random length
            const angleOffset1 = (Math.random() - 0.5) * maxAngle; // Random angle
            const angleOffset2 = (Math.random() - 0.5) * maxAngle;

            let newBranches = [];
            for (const offset of [angleOffset1, angleOffset2]) {
                const xEnd = x - length * Math.cos(angle + offset);
                const yEnd = y - length * Math.sin(angle + offset);

                if (!lineIntersects(x, y, xEnd, yEnd)) {
                    drawLine(x, y, xEnd, yEnd); // Draw branch if no intersection
                    drawnLines.push({ x1: x, y1: y, x2: xEnd, y2: yEnd }); // Add to drawn lines
                    newBranches.push({ x: xEnd, y: yEnd, angle: angle + offset, depth: depth + 1 });
                }
            }

            return newBranches; // Return only non-intersecting branches
        }

        function growTree() {
            let newBranches = [];

            branches.forEach(branchData => {
                const { x, y, angle, depth } = branchData;
                newBranches.push(...branch(x, y, angle, depth));
            });

            branches = newBranches; // Only keep the new branches for the next growth step
        }

        function animate() {
            growTree(); // Add new branches
            setTimeout(animate, growSpeed); // Loop animation
        }

        function initializeTree() {
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 2;

            // Start with a single branch at the bottom center
            branches.push({
                x: canvas.width / 2,
                y: canvas.height,
                angle: Math.PI / 2, // Straight up
                depth: 0 // Initial depth
            });

            animate(); // Start animation
        }

        // Initialize and start the tree
        initializeTree();
    </script>
</body>
</html>
